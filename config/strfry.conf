# Strfry Configuration for Funnel
# See: https://github.com/hoytech/strfry/blob/master/strfry.conf

##
## General settings
##

# Directory to store the LMDB database
db = "/app/strfry-db/"

# Maximum database size in bytes (16GB default, increase if needed)
dbParams {
    maxreaders = 256
    mapsize = 1099511627776  # 1TB (doesn't allocate upfront, just reserves address space)
}

##
## Relay information (NIP-11)
##

relay {
    # Network settings
    bind = "0.0.0.0"
    port = 7777

    # Relay info for NIP-11
    info {
        name = "Funnel Relay"
        description = "Video-focused Nostr relay"
        pubkey = ""
        contact = ""
    }

    # Maximum message size (default 128KB, but videos may have larger metadata)
    maxWebsocketPayloadSize = 524288  # 512KB

    # WebSocket ping interval
    autoPingSeconds = 55

    # Enable NIP-11 info document
    enableTempRelayInfo = true

    # Disable TLS (handle at load balancer)
    ssl {
        enabled = false
    }
}

##
## Event handling
##

events {
    # Maximum number of tags per event
    maxNumTags = 5000

    # Maximum size of tag values
    maxTagValSize = 1024

    # Reject events older than this (0 = no limit)
    rejectEventsOlderThanSeconds = 0

    # Reject events newer than this many seconds in the future
    rejectEventsNewerThanSeconds = 900  # 15 minutes

    # Event retention (0 = keep forever)
    # ephemeralEventsLifetimeSeconds = 300  # Uncomment to auto-delete ephemeral events
}

##
## Query limits
##

filter {
    # Maximum subscriptions per connection
    maxSubscriptions = 20

    # Maximum filters per subscription
    maxFilters = 10

    # Maximum limit parameter
    maxLimit = 5000

    # Maximum filter execution time
    maxFilterTime = 10000  # 10 seconds
}

##
## Write policy
##

writePolicy {
    # Plugin for custom write validation (optional)
    # plugin = "/app/write-policy.sh"
}

##
## Negentropy sync
##

negentropy {
    enabled = true
    # maxSyncEvents = 10000000
}
